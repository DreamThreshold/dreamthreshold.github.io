<!DOCTYPE html>
    <html>
<!-- Created 2024-10-23 / Release 0.1 2024-11-21 -->
<head>
  <meta charset="UTF-8">
  <title>Comp/Decomp Country</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="icon" href="data:image/svg+xml;base64,PHN2ZwogICB3aWR0aD0iNjkuMzg5NTcybW0iCiAgIGhlaWdodD0iODcuNDI1MTg2bW0iCiAgIHZpZXdCb3g9IjAgMCA2OS4zODk1NzIgODcuNDI1MTg2IgogICB2ZXJzaW9uPSIxLjEiCiAgIGlkPSJzdmcxIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxIiAvPgogIDxnCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTIuMjU5NDUxLC0zLjcwMjU1MzUpIj4KICAgIDxwYXRoCiAgICAgICBpZD0icGF0aDEiCiAgICAgICBzdHlsZT0iZmlsbDojYjNiMzAwO2ZpbGwtb3BhY2l0eToxO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowLjM2Njk7c3Ryb2tlLW9wYWNpdHk6MC42OSIKICAgICAgIGQ9Im0gNTkuNDA2NDQzLDMuNzAyNTUzNSAtMi4yNjczMDUsMC42NTI0MTQgLTIuNDI0OTE1LDEuOTIyMzY1IDMuOTI4Nyw3LjY1OTczNzUgYyAwLDAgLTAuMDI1NTcsMjQuMTMzMTExIC02LjY0NDI5NywzNC4wNDA1NjEgLTEwLjAyOTEsMTYuNjM0NDk3IC0zNS43MjU1MywyNi4yOTgwNjIgLTM3Ljk0OTg4LDM3LjUzMzg4MiBsIC0xLjc4OTI5NSwyLjYwMDYxOCAwLjkyMjQyMiwyLjM3NTgyNSAyLjc0NDAyLC0wLjIwNTQyNSBjIDAsMCAxMy4zNjQyMSw0LjcyNzU5NyAzMy4zOTMzMSwtOC4xNzkwODggQyA3MC44NzE1MjgsNjguMjE1MTk4IDgyLjg0OTc3MSw1NS42MTEyNzEgODEuNTUzNjcxLDM0LjI4MzM2NiA4MC40NjQyMjgsMTYuMzU1OTkgNjYuNDgyMjM4LDExLjgyMzQ5NSA2Ni40ODIyMzgsMTEuODIzNDk1IFoiIC8+CiAgPC9nPgo8L3N2Zz4K" />

<style></style>

<link href="main.css" rel="stylesheet" />

</head>

<!-- for various string, array/matrix, data interleaving, and formatting functions -->
<script src="utilities.js"></script>

<!-- for various string, array/matrix, data interleaving, and formatting functions -->
<script src="compression.js"></script>

<!-- Our "3D" SVG script, for bitplanes and more -->
<script src="svg3d.js"></script>

<body>

  <svg width="100vw" height="100vh" style="position:absolute;">
    <!-- oooh banana -->
    <pattern id="bananas" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse">

      <path d="M 31.320569 9.8309245
      L 30.413647 10.09189
      L 29.443681 10.860836
      L 31.015161 13.924731
      C 31.015161 13.924731 31.004927 23.577975 28.357442 27.540955
      C 24.345802 34.194754 14.06723 38.06018 13.17749 42.554508
      L 12.461772 43.594755
      L 12.830741 44.545085
      L 13.928349 44.462919
      C 13.928349 44.462919 19.274033 46.353958 27.285673 41.191284
      C 35.906603 35.635986 40.6979 30.594415 40.17946 22.063253
      C 39.743683 14.892303 34.150887 13.079305 34.150887 13.079305
      L 31.320569 9.8309245
      z

      M 81.320618 59.830973
      L 80.413696 60.091939
      L 79.44373 60.860885
      L 81.01521 63.92478
      C 81.01521 63.92478 81.004976 73.578023 78.357491 77.541003
      C 74.345851 84.194802 64.067279 88.060229 63.177539 92.554557
      L 62.46182 93.594804
      L 62.83079 94.545133
      L 63.928398 94.462968
      C 63.928398 94.462968 69.274082 96.354007 77.285722 91.191333
      C 85.906652 85.636035 90.697948 80.594464 90.179508 72.063302
      C 89.743731 64.892352 84.150936 63.079354 84.150936 63.079354
      L 81.320618 59.830973
      z" stroke="none" fill="rgb(30, 30, 30)" ></path>
    </pattern>

    <rect x="0" y="0" width="100vw" height="100vh" fill="url(#bananas)"></rect>

  </svg>


  <div class="main" id="main">
    <!-- <div id="animationBottom" class="animationBottom"></div> -->
    <div id="navbar">
      <h4><i style="padding-left:5ch;">Comp / Decomp Country</i></h4>
    </div>

    <div id="workspace_1" class="workspace">
      <div id="panelgrid_1" class="panelgrid"></div>
      <div id="panel_links_1" class="panel_links"></div>
    </div>

  </div>


  <div id="animationTop" class="animationTop"></div>

<!-- for animations (mainly decompression animations) -->
<script src="animation.js"></script>

<!-- for GUI panels and their methods -->
<script src="panels.js"></script>

<script>

  //
  //   Create the ui and panels
  //

let c0 = 2, c1 = 8, c2 = 16, c3=27-2;
let cx = c2*1;
let dx = cx+5;
let d0 = c1-1, d1 = c2-1, d2=c3-1, d3=32;

const workspace1 = new Workspace( document.getElementById("panelgrid_1") );

var links = [];

// input and decompressor
var inputPanel = new FilePanel(workspace1, 1,  3,    1, 4,  "File: Compressed Tileset Gfx");
var decompressPanel = new ChrDecompressPanel(workspace1, 1,  2,    5, 8,  "Decompress");
links.push( workspace1.addLink( new Link(inputPanel.outputPorts.out, decompressPanel.inputPorts.in) ) );

// // hex viewers for comp/decomp
// var compHexPanel = new HexPanel( workspace1,  1, 10, c1, d1,  "Hex View: Compressed Data"); // 1
// links.push( workspace1.addLink( new Link(inputPanel.outputPorts.out, compHexPanel.inputPorts.in) ) );
// var decompHexPanel = new HexPanel( workspace1,  10, 19, c1, d1,  "Hex View: Decompressed Data"); // 2
// links.push( workspace1.addLink( new Link(decompressPanel.outputPorts.out, decompHexPanel.inputPorts.in) ) );

// // bitplane viewer
// var bitplanePanel = new BitplanePanel( workspace1,   1, 12,    c2, d2, "View Bitplanes");
// links.push( workspace1.addLink( new Link(decompHexPanel.outputPorts.out, bitplanePanel.inputPorts.in) ) );


// unbitplane and show tiles
var unbitplanePanel = new UnbitplanePanel( workspace1,   5, 6,    7, 9, "Unbitplane");
links.push( workspace1.addLink( new Link(decompressPanel.outputPorts.out, unbitplanePanel.inputPorts.in) ) );
var tilesetViewer = new TilesetPanel( workspace1,  8, 15,   9, 16,  "Tileset (8x8 Tiles)");
links.push( workspace1.addLink( new Link( unbitplanePanel.outputPorts.out, tilesetViewer.inputPorts.in) ) );



// palette
var paletteInputPanel = new FilePanel(workspace1, 1,  3,    11, 16,  "File: Palette");  //  3
var pal2rgbPanel = new Palette2RGBPanel(workspace1,  1,  2,    18, 23,  "Convert Palette: SNES 15 bit to RGB 24 bit");  //  3
links.push( workspace1.addLink( new Link( paletteInputPanel.outputPorts.out, pal2rgbPanel.inputPorts.in) ) );

var paletteViewer = new PalettePanel( workspace1,   3,  6,    21, 25,  "Palette" ); // 4
links.push( workspace1.addLink( new Link( pal2rgbPanel.outputPorts.out, paletteViewer.inputPorts.in) ) );

// metatiles
var metatileInputPanel = new FilePanel(workspace1,  7, 9,    c3, c3+3,  "File: Tilemap32 (Metatiles)");
var buildMetatilesPanel = new BuildMetatilesPanel(workspace1,  7, 7,    c3+4, c3+3+4,  "Assemble Metatiles Gfx");
// ["rgbPalette", "tilemap32", "unbitplanedTiles"]
links.push( workspace1.addLink( new Link( metatileInputPanel.outputPorts.out, buildMetatilesPanel.inputPorts.tilemap32) ) );
links.push( workspace1.addLink( new Link( tilesetViewer.outputPorts.out, buildMetatilesPanel.inputPorts.unbitplanedTiles) ) );
links.push( workspace1.addLink( new Link( paletteViewer.outputPorts.out, buildMetatilesPanel.inputPorts.rgbPalette) ) );

var metatilesViewer = new MetatilesPanel(workspace1, 9, 15,    c3, d3,  "32x32 Tiles (Metatiles)");
links.push( workspace1.addLink( new Link( buildMetatilesPanel.outputPorts.out, metatilesViewer.inputPorts.in) ) );

// level map
var levelmapInputPanel = new FilePanel(workspace1, 16,  18,    c3, c3+3,  "File: Level Map");
var buildLevelMapPanel = new BuildLevelMapPanel(workspace1,  16, 16,    c3+4, c3+3+4,  "Assemble Level Map Gfx");
// ["rgbPalette", "tilemap32", "unbitplanedTiles"]
links.push( workspace1.addLink( new Link( levelmapInputPanel.outputPorts.out, buildLevelMapPanel.inputPorts.levelMap) ) );
links.push( workspace1.addLink( new Link( metatilesViewer.outputPorts.out, buildLevelMapPanel.inputPorts.metatileArray) ) );

var levelMapViewer = new LevelMapPanel( workspace1,  18, 28,    c3, d3,  "Level Map Gfx");
links.push( workspace1.addLink( new Link( buildLevelMapPanel.outputPorts.out, levelMapViewer.inputPorts.in) ) );


var decompPipelineText = `\
<div class="text_content" >
  <p>
    This is a streamlined view of the process to get from compressed tileset gfx, palette, metatiles/tilemap32, and level map to level map graphics (excludes items, sprites, backgrounds, etc).
    </p>
  <p>
    Go to the "â˜°" menu of tileset, palette, metatiles, and level map viewer panels to download a .png image.
  </p>
  <p>
    <b>Level map limitations.</b> Level maps in DKC actually contain all levels of a given archetype (as well as bonus rooms and some level background layers). Without knowing the start and end coordinates for individual levels, this app currently sets an arbitrary limit of the ending x coordinate of the first level. This app currently cannot handle water levels and ice cave levels - those are arranged vertically rather than horizontally.
  </p>
  <p>
    <a href="index.html">Back to main page</a>.
  </p>
</div>`;
var descriptionC = new TextPanel( workspace1,  23, 28,    c0, c1+4+2,  "About", decompPipelineText );

// reposition based on a manually-adjusted layout
workspace1.repositionPanels(`
{"0":{"left":20,"top":292,"width":250,"height":71.01666259765625},"1":{"left":294,"top":337,"width":139,"height":44.100006103515625},"2":{"left":459,"top":391,"width":133,"height":38.43333435058594},"3":{"left":640,"top":412,"width":153,"height":432.20001220703125},"4":{"left":20,"top":197,"width":247,"height":60.350006103515625},"5":{"left":288,"top":220,"width":329,"height":36.76666259765625},"6":{"left":637,"top":248,"width":163,"height":110.91667175292969},"7":{"left":23,"top":105,"width":242,"height":68.35000610351562},"8":{"left":868,"top":211,"width":218,"height":32},"9":{"left":933,"top":282,"width":257,"height":550.63330078125},"10":{"left":24,"top":20,"width":233,"height":66.35000610351562},"11":{"left":1162,"top":173,"width":246,"height":33},"12":{"left":1280,"top":271,"width":568,"height":564.9166870117188},"13":{"left":33,"top":480,"width":453,"height":324}}
`);

</script>

</body>

</html>